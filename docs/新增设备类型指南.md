# 新增设备类型指南

本文档说明在项目中新增一个设备类型需要修改的所有位置。

## 必须修改的文件

### 1. 固件代码

#### `components/base_device/include/base_device.h`
```c
// 添加设备类型数字定义
#define DEVICE_新设备名 5  // 数字递增

// 添加条件编译块
#ifdef CONFIG_DEVICE_新设备名
    #define DEVICE_TYPE_INDEX DEVICE_新设备名
    #define DEVICE_TYPE_NAME "新设备名"
#endif
```

#### `components/base_device/CMakeLists.txt`
```cmake
# 添加条件编译源文件
if(CONFIG_DEVICE_新设备名)
    list(APPEND srcs "新设备名.c")
endif()
```

#### `components/base_device/Kconfig`
```
# 在choice DEVICE_SELECTION中添加
config DEVICE_新设备名
    bool "新设备名"
    help
        新设备的帮助信息
```

#### `components/base_device/新设备名.c`
- 创建新的设备源文件
- 实现设备特定的属性和功能

### 2. 测试代码

#### `pytest/virtual_devices.py`
```python
# 添加新设备类
class 新设备名Device(BaseVirtualDevice):
    def __init__(self, device_id: str, **kwargs):
        super().__init__(device_id, "新设备名", **kwargs)
        # 设备特定初始化
```

#### `pytest/device_manager.py`
```python
# 在DEVICE_TYPES字典中添加
DEVICE_TYPES = {
    '新设备名': 新设备名Device,
    # ... 其他设备
}

# 在命令行参数choices中添加新设备类型
```

### 3. 文档

#### `docs/device_api_reference.md`
- 添加新设备的API文档
- 描述设备属性、功能和使用方法

## 注意事项

1. **数字定义**：设备类型的数字定义要保持唯一且递增
2. **命名规范**：设备名称要保持一致性（大写用于宏定义，小写用于Python）
3. **完整性检查**：确保所有相关文件都已更新
4. **测试验证**：添加设备后要进行编译和功能测试

## 当前已知问题

- `base_device.h` 中缺少 `#define DEVICE_ZIDONGSUO 5` 的定义，需要补充